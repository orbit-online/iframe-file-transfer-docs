import { HeroPattern } from '@/components/HeroPattern';

export const metadata = {
	title: 'API react/receiver',
	description: 'Documentation of the low-level APIs, the high level abstractions are built upon.'

}

<HeroPattern />

# React receiver API

The react API is mostly reduced to a single hook, where the only that is needed to be passed to the hook is `submitHandler` and an `errorHandler`. {{ className: 'lead' }}

## Responsibility

As an implementor of a receiver you are responsible for providing a form submit handler that uploads the file along with form- and metadata to a webservice, and return a resolved promised upon success or rejected promise upon error.

Files are transfered to the receiver along with an unique id, that is important in order to be able to update the file in Orbit afterwards via the Orbit Import Framework.

## Minimum working application

Will take a look at this bare minimum example below, and explain the API in terms of this simplified usage.

```tsx
import { useOrbitIframeFileTransferReceiver } from '@orbit-online/iframe-file-transfer/react/receiver.js';

async function onOrbitFileReceiverFormSubmit(
	url: string,
	method: string,
	formData: FormData,
	orbitEntityData: Record<string, any>,
): Promise<void> {
	const request = new Request(url, {
		body: formData,
		method: method,
	});

	const response = await fetch(request);
	if (!response.ok) {
		throw new Error(
			'Upload was unsuccesful, please contact external system administrator at support@external.system with details on how to reproduce this error.',
		);
	}
}

const App = () => {
	const {
		error,
		file,
		fileInputRef,
		formRef,
		imageSrc,
		onCancel,
		onSubmit,
		orbitEntityData,
		orbitFileId,
		progress,
		setError,
	} = useOrbitIframeFileTransferReceiver(onOrbitFileReceiverFormSubmit);

	const errorContainer =
		error == null ? null : (
			<div style={errorContainerStyles}>{error.message}</div>
		);
	return (
		<form
			action="/upload"
			encType="multipart/form-data"
			method="post"
			onSubmit={onSubmit}
			ref={formRef}
		>
			{errorContainer}
			<input
				type="hidden"
				name="orbitFileId"
				ref={fileIdInputRef}
				value={orbitFileId}
				readOnly
				required
			/>
			<input
				type="text"
				name="file"
				ref={fileInputRef}
				value={file?.name}
				disabled
				required
			/>
			<input type="button" value="Cancel" onClick={onCancel} />
			<input type="submit" value="Upload" />
		</form>
	);
};
```

---

## The hook

<Row>
	<Col>
		<Properties>
			<Property name="formRef" type="React.RefObject<HTMLFormElement>">
				Ref object that should be passed to the `ref` prop of the form element.
			</Property>
			<Property name="onSubmit" type="React.FormEventHandler<HTMLFormElement>">
				Form submit handler, should be passed along to the a `onSubmit` of the form element.
			</Property>
			<Property name="error" type="Error | null">
				Property containing the error that occured, or `null` if no error has occured.
			</Property>
			<Property name="file" type="File | null">
				The file that has been transfered to the receiver (iframe). This is prop is `null` ontil the `status` is `complete`.
			</Property>
			<Property name="fileInputRef" type="React.RefObject<HTMLInputElement>">
				Ref object that should be passed to the file id input element.
			</Property>
			<Property name="imageSrc" type="string | undefined">
				Image source that can be passed to an img element, is only available when the file transfer is complete and the content is an image the browser supports.
			</Property>
			<Property name="onCancel" type="React.MouseEventHandler<HTMLInputElement>">
				Cancel handler that should be passed to the `onClick` prop of an input element of type button,
				to support the users can cancel the file transfer.
			</Property>
			<Property name="orbitEntityData" type="Record<string, any>">
				Metadata about the entity the file is uploaded within Orbit.
			</Property>
			<Property name="orbitFileId" type="string | undefined">
				The unique external file id from Orbit, that should be passed to the Orbit files importer, when the file content has been uploaded and processed by the external system, and the file should be updated in Orbit with the processed content.
			</Property>
			<Property name="progress" type="number | undefined">
				Percentage of file transfer progress from the sender to the receiver.
			</Property>
			<Property name="setError" type="SetErrFn">
				Error hook, if the react application want to communicate back to Orbit that a 3rd party error occured,
				this will populate the `error` property, and set the `status` property to `error` as well.
			</Property>
			<Property name="status" type="initial | transfering | complete | error">
				The current status of the file transfer from the sender to the receiver.
				- `initial` when connection to the sender has not yet been established.
				- `transfering` when the connection has been established, and transmission is running.
			</Property>
    	</Properties>
    </Col>
    <Col sticky>
    	<CodeGroup title="">
    	```tsx
    	type SubmitHandler = (url: string, method: string, formData: FormData, orbitEntityData: Record<string, any>) => Promise<void>;
    	type SetErrFn = (err: Error) => void;

    	function useOrbitIframeFileTransferReceiver(submitHandler: SubmitHandler): {
    		readonly error: Maybe<Error>,
    		readonly file: Maybe<File>,
    		readonly fileInputRef: React.RefObject<HTMLInputElement>,
    		readonly formRef: React.RefObject<HTMLFormElement>,
    		readonly imageSrc: string | undefined,
    		readonly onCancel: React.MouseEventHandler<HTMLInputElement>,
    		readonly onSubmit: React.FormEventHandler<HTMLFormElement>,
    		readonly orbitEntityData: Record<string, any>,
    		readonly orbitFileId: string | undefined,
    		readonly progress: number | undefined,
    		readonly setError: (err: Error) => void,
    		readonly status: 'initial' | 'transfering' | 'complete' | 'error',
    	};
    	```
    	</CodeGroup>
    </Col>

</Row>
